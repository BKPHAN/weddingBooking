<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phong Cách Tiệc Cưới - Tràng An Palace</title>
    <meta name="description"
        content="Chiêm ngưỡng các phong cách trang trí tiệc cưới đẳng cấp tại Tràng An Palace: Luxury, Classic, Modern, Rustic.">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&family=Great+Vibes&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Lightbox for Gallery -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">
</head>

<body>

    <div th:replace="~{fragments/header :: header}"></div>

    <!-- Hero Banner -->
    <section class="gallery-hero">
        <div class="gallery-hero-overlay"></div>
        <img th:src="${galleryItems != null and !galleryItems.isEmpty() ? galleryItems[0].imageUrl : '/images/gallery/1.jpg'}"
            alt="Phong Cách Tiệc Cưới" class="gallery-hero-bg"
            onerror="this.src='https://placehold.co/1920x600?text=Wedding+Concepts'">
        <div class="gallery-hero-content">
            <p style="font-family: var(--font-accent); font-size: 2.5rem; color: var(--color-gold);">Bộ Sưu Tập</p>
            <h1 style="font-family: 'Playfair Display', serif; color: white; font-size: 3.5rem; font-weight: 700; margin: 20px 0;">Phong Cách Tiệc Cưới</h1>
            <p>Nơi hiện thực hóa giấc mơ cổ tích của bạn</p>
        </div>
    </section>

    <!-- Search Section -->
    <div class="container" style="position: relative; z-index: 10;">
        <div class="search-container">
            <div class="search-input-wrapper">
                <input type="text" id="gallerySearch" class="search-input"
                    placeholder="Tìm kiếm phong cách... (hoặc nói 'Cổ điển'...)">
                <button id="galleryMicBtn" class="search-mic" title="Tìm kiếm bằng giọng nói" style="display: none;">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
            <button class="search-btn" onclick="performSearch(document.getElementById('gallerySearch').value)">
                <i class="fas fa-search"></i> Tìm Kiếm
            </button>
        </div>
        <p id="speechStatus" class="text-center"
            style="margin-top: 5px; font-size: 0.9rem; min-height: 20px; color: var(--color-gold);"></p>
    </div>

    <!-- Concept Introduction -->
    <section class="section text-center">
        <div class="container">
            <div style="max-width: 800px; margin: 0 auto;">
                <h2 class="text-teal">Không Gian Tiệc Cưới Đẳng Cấp</h2>
                <div class="divider-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <p>Mỗi sảnh tiệc tại Tràng An Palace là một tác phẩm nghệ thuật, được thiết kế tỉ mỉ để tôn vinh câu
                    chuyện tình yêu của bạn. Từ phong cách cổ điển sang trọng đến hiện đại tinh tế, chúng tôi hiện thực
                    hóa mọi ý tưởng về đám cưới trong mơ.</p>
            </div>

        </div>
    </section>

    <!-- Gallery Grid - LOADED FROM DATABASE -->
    <section class="section">
        <div class="container">
            <div class="grid-col-3" style="gap: 30px;">
                <!-- Dynamic Gallery Items from Database -->
                <div th:each="item : ${galleryItems}"
                     th:class="'gallery-item ' + ${item.category != null ? item.category.toLowerCase() : 'all'}"
                     style="overflow: visible; border-radius: 8px;">
                    <div class="menu-card"
                        style="padding: 0; overflow: hidden; height: 100%; display: flex; flex-direction: column;">
                        <div class="img-wrapper" style="height: 250px; overflow: hidden; position: relative;">
                            <a th:href="@{${item.imageUrl}}"
                                data-lightbox="gallery"
                                th:data-title="${item.name + ' - ' + item.description}"
                                style="display: block; height: 100%;">
                                <img th:src="@{${item.imageUrl}}"
                                    th:alt="${item.name}"
                                    style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease;"
                                    onerror="this.src='https://placehold.co/600x400?text=Gallery+Image'">
                                <div class="gallery-overlay"><i class="fas fa-search-plus"></i></div>
                            </a>
                        </div>
                        <div class="menu-header" style="padding: 20px; margin-bottom: 0; flex-grow: 1;">
                            <h3 style="font-size: 1.2rem; margin-bottom: 5px;" th:text="${item.category != null ? 'Phong Cách ' + item.category : item.name}">Gallery Item</h3>
                            <div class="price"
                                style="font-size: 1rem; color: var(--color-text-light); font-weight: normal;" th:text="${item.description}">Description</div>
                        </div>
                    </div>
                </div>




            </div>
        </div>
    </section>

    <!-- Video Tour -->
    <section class="section bg-dark text-white"
        style="background-image: url('https://tranganpalace.vn/wp-content/uploads/2020/02/IMG_0396.jpg.webp'); background-size: cover; background-attachment: fixed; position: relative;">
        <div style="position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7);"></div>
        <div class="container text-center" style="position: relative; z-index: 2;">
            <div class="divider-icon">
                <i class="fas fa-video"></i>
            </div>
            <h2>Video Tour 360°</h2>
            <p class="mb-5">Khám phá toàn cảnh không gian tiệc cưới lộng lẫy tại Tràng An Palace</p>

            <a href="https://www.youtube.com/watch?v=SomeVideoID" class="btn btn-outline"
                style="color: #fff; border-color: #fff; border-radius: 50%; width: 80px; height: 80px; display: inline-flex; align-items: center; justify-content: center; font-size: 2rem;">
                <i class="fas fa-play" style="margin-left: 5px;"></i>
            </a>
        </div>
    </section>

    <!-- Real Weddings -->
    <section class="section">
        <div class="container">
            <div class="section-header text-center">
                <h2>
                    <a href="/collection" style="color: inherit; text-decoration: none;" title="Xem Bộ Sưu Tập">
                        Chuyện Tình Yêu (Real Weddings)
                    </a>
                </h2>
                <p>Những khoảnh khắc hạnh phúc có thật tại Tràng An Palace</p>
            </div>

            <div class="grid-col-3">
                <a href="/collection" class="real-wedding-card"
                    style="display: block; text-decoration: none; color: inherit;">
                    <img th:src="@{/images/collection/real-wedding-1.jpg}" alt="Wedding 1">
                    <div class="real-wedding-info">
                        <h4>Văn Hậu & Mai Linh</h4>
                        <p>Ngày 15/10/2023</p>
                        <span style="color: var(--color-gold); font-size: 0.9rem;">Xem Album <i
                                class="fas fa-arrow-right"></i></span>
                    </div>
                </a>
                <a href="/collection" class="real-wedding-card"
                    style="display: block; text-decoration: none; color: inherit;">
                    <img th:src="@{/images/collection/real-wedding-2.jpg}" alt="Wedding 2">
                    <div class="real-wedding-info">
                        <h4>Tuấn Anh & Huyền My</h4>
                        <p>Ngày 22/09/2023</p>
                        <span style="color: var(--color-gold); font-size: 0.9rem;">Xem Album <i
                                class="fas fa-arrow-right"></i></span>
                    </div>
                </a>
                <a href="/collection" class="real-wedding-card"
                    style="display: block; text-decoration: none; color: inherit;">
                    <img th:src="@{/images/collection/real-wedding-3.jpg}" alt="Wedding 3">
                    <div class="real-wedding-info">
                        <h4>Minh Hiếu & Thùy Dương</h4>
                        <p>Ngày 05/09/2023</p>
                        <span style="color: var(--color-gold); font-size: 0.9rem;">Xem Album <i
                                class="fas fa-arrow-right"></i></span>
                    </div>
                </a>
            </div>
        </div>
    </section>


    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- Lightbox2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
    <script>
        function filterGallery(category) {
            // Update buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Clear search
            document.getElementById('gallerySearch').value = '';

            // Filter items
            const items = document.querySelectorAll('.gallery-item');
            items.forEach(item => {
                if (category === 'all' || item.classList.contains(category)) {
                    item.style.display = 'block';
                    // Animation
                    item.style.opacity = '0';
                    item.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        item.style.opacity = '1';
                        item.style.transform = 'scale(1)';
                    }, 50);
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Search Logic
        const searchInput = document.getElementById('gallerySearch');

        function performSearch(query) {
            query = query.toLowerCase();
            const speechStatus = document.getElementById('speechStatus');
            let resultCount = 0;

            if (query.length > 0) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            }

            const items = document.querySelectorAll('.gallery-item');
            items.forEach(item => {
                const title = item.querySelector('a').getAttribute('data-title').toLowerCase();
                if (title.includes(query)) {
                    item.style.display = 'block';
                    resultCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            // Show result notification
            if (query.length > 0) {
                if (resultCount > 0) {
                    speechStatus.textContent = `Tìm thấy ${resultCount} kết quả cho "${query}"`;
                    speechStatus.style.color = "var(--color-success, #28a745)";
                } else {
                    speechStatus.textContent = `Không tìm thấy kết quả cho "${query}"`;
                    speechStatus.style.color = "var(--color-danger, #dc3545)";
                }
                setTimeout(() => speechStatus.textContent = "", 4000);
            } else {
                speechStatus.textContent = "";
            }
        }

        // Trigger search on Enter key
        searchInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                performSearch(searchInput.value);
            }
        });

        // Remove input event listener
        // searchInput.addEventListener('input', function (e) { performSearch(e.target.value); });

        // Speech Recognition Setup
        const micBtn = document.getElementById('galleryMicBtn');
        const speechStatus = document.getElementById('speechStatus');

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            // Show mic button if supported
            micBtn.style.display = 'block';

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            recognition.continuous = true; // Keep listening until silence
            recognition.lang = 'vi-VN';
            recognition.interimResults = true; // Enable streaming

            let silenceTimeout = null;
            const SILENCE_DELAY = 3000; // 3 seconds

            function resetSilenceTimeout() {
                if (silenceTimeout) {
                    clearTimeout(silenceTimeout);
                }
                silenceTimeout = setTimeout(() => {
                    recognition.stop();
                }, SILENCE_DELAY);
            }

            micBtn.addEventListener('click', () => {
                if (micBtn.classList.contains('listening')) {
                    if (silenceTimeout) clearTimeout(silenceTimeout);
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });

            recognition.onstart = () => {
                micBtn.classList.add('listening');
                speechStatus.textContent = "Đang lắng nghe...";
                resetSilenceTimeout(); // Start timeout on begin
            };

            recognition.onend = () => {
                micBtn.classList.remove('listening');
                if (silenceTimeout) clearTimeout(silenceTimeout);
                if (!searchInput.value) {
                    speechStatus.textContent = "";
                }
            };

            recognition.onresult = (event) => {
                resetSilenceTimeout(); // Reset timeout on speech detected

                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                // Show both final and interim results
                searchInput.value = finalTranscript + interimTranscript;
                speechStatus.textContent = interimTranscript ? `Đang nghe: "${interimTranscript}"` : `Đã tìm: "${finalTranscript}"`;
                speechStatus.style.color = interimTranscript ? "var(--color-gold)" : "var(--color-success)";

                // Perform search with current text
                // performSearch(searchInput.value); // DISABLED: Auto-search removed

                // Clear status after final result
                if (finalTranscript && !interimTranscript) {
                    setTimeout(() => speechStatus.textContent = "", 3000);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                micBtn.classList.remove('listening');
                if (silenceTimeout) clearTimeout(silenceTimeout);
                speechStatus.textContent = "Không nghe rõ, vui lòng thử lại.";
                speechStatus.style.color = "var(--color-danger)";
            };
        } else {
            console.log('Web Speech API not supported in this browser.');
        }

    </script>
</body>

</html>